<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<script src="/static/sendMessageTimer.js"></script>

<script>

    function sendMessage() {
        callToSendMail();
    }

    function startService(action, operation) {
        let xhr = new XMLHttpRequest();
        let hostname = location.hostname;
        xhr.open('POST', 'http://' + hostname + ':8080/is_working', true);
        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
        xhr.setRequestHeader('Access-Control-Allow-Methods', 'POST');
        xhr.setRequestHeader("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onload = function () {
            if (xhr.status === 200) {
                let data = JSON.parse(xhr.responseText);
                let status = data["result"];
                if (operation === "service"){
                    if (status) {
                    }
                }
                else if (operation === "check"){
                    let startButton = document.getElementById("start");
                    let stopButton = document.getElementById("stop");
                    let btnStatus;
                    if (status){
                        btnStatus = true;
                    } else {
                        btnStatus = false;
                    }
                    stopButton.disabled = !btnStatus;
                    startButton.disabled = btnStatus;
                }
            }
        }
        let body = "{" +
            " \"action\" : \"" + action + "\"" +
            "}";
        xhr.send(body);
    }

    function startInput(isStarted) {
        let startButton = document.getElementById("start");
        let stopButton = document.getElementById("stop");
        stopButton.disabled = !isStarted;
        startButton.disabled = isStarted;

        let action;
        if (isStarted) {
            action = "start"
        } else if (isStarted === false) {
            action = "stop";
        }

        startService(action, "service");
    }
</script>

<style>
    .content {
        text-align: center;
    }

    .btn {
        margin-top: 2px;
    }

</style>


<body>

<!--<input type="button" value = "send Email" onclick="callToSendMail()">-->
<div class="content">
    <div class="btn">
        <button type="button" id="start" onclick="startInput(true)">Start sending</button>
    </div>
    <div class="btn">
        <button class="btn" type="button" id="stop" onclick="startInput(false)">Stop sending</button>
    </div>
    <div class="btn">
        <button class="btn" type="button" id="send" onclick="sendMessage()">Send</button>
    </div>
</div>


</body>

<script>
    let stopButton = document.getElementById("stop");
    let startButton = document.getElementById("start");
    let sendButton = document.getElementById("send");
    stopButton.disabled = true;

    let windowHeight = window.outerHeight;
    let windowWidth = window.outerWidth;

    stopButton.setAttribute("style", "height: " + windowHeight * 0.3 + "px; width: " + windowWidth * 0.5 + "px;");
    startButton.setAttribute("style", "height: " + windowHeight * 0.3 + "px; width: " + windowWidth * 0.5 + "px;");
    sendButton.setAttribute("style", "height: " + windowHeight * 0.3 + "px; width: " + windowWidth * 0.5 + "px;");

    startService('status', 'check')
</script>

</html>